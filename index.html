<!DOCTYPE html>
<html lang="pt-BR" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sabor e Sa√∫de - Card√°pio de Marmitas Fit</title>
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            forest: '#2D5A3D',
            sage: '#8FAE8B',
            cream: '#FDF8F3',
            terracotta: '#C4785A',
            charcoal: '#2A2A2A'
          }
        }
      }
    }
  </script>
  <style>
    .font-display { font-family: 'Playfair Display', serif; }
    .font-body { font-family: 'DM Sans', sans-serif; }
    body { background-color: #FDF8F3; }
    .fade-in { animation: fadeIn 0.3s ease-out; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .scroll-container::-webkit-scrollbar { width: 6px; }
    .scroll-container::-webkit-scrollbar-thumb { background: #8FAE8B; border-radius: 10px; }
    .modal-bg { background: rgba(0,0,0,0.5); backdrop-filter: blur(2px); }
    .pulse-animation { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
    input[type="number"].qty-input {
      -moz-appearance: textfield;
      appearance: textfield;
    }
    input[type="number"].qty-input::-webkit-inner-spin-button,
    input[type="number"].qty-input::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(253, 248, 243, 0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
  </style>
</head>
<body class="h-full font-body text-charcoal">

  <!-- LOADING -->
  <div id="loading" class="loading-overlay">
    <div class="text-center">
      <div class="animate-spin rounded-full h-16 w-16 border-b-4 border-forest mx-auto mb-4"></div>
      <p class="text-forest font-bold">Carregando card√°pio...</p>
    </div>
  </div>

  <!-- MODAL DE LOGIN PARA ADMINISTRADOR -->
  <div id="admin-modal" class="hidden fixed inset-0 z-[60] flex items-center justify-center p-4 modal-bg">
    <div class="bg-white rounded-3xl p-8 w-full max-w-sm shadow-2xl">
      <h2 class="font-display text-2xl text-forest mb-4">Acesso Administrativo</h2>
      <form onsubmit="handleLogin(event)" class="space-y-4">
        <div>
          <label class="block text-xs font-bold uppercase text-gray-400 mb-1">Usu√°rio</label>
          <input id="login-username" type="text" class="w-full px-4 py-2 border rounded-lg focus:outline-forest" autocomplete="username">
        </div>
        <div>
          <label class="block text-xs font-bold uppercase text-gray-400 mb-1">Senha</label>
          <input id="login-password" type="password" class="w-full px-4 py-2 border rounded-lg focus:outline-forest" autocomplete="current-password">
        </div>
        <button type="submit" class="w-full bg-forest text-white py-3 rounded-xl font-bold hover:bg-forest/90 transition-all">Entrar no Painel</button>
        <button type="button" onclick="closeAdminModal()" class="w-full text-gray-400 text-sm py-2">Cancelar</button>
        <p id="login-error" class="text-red-500 text-xs text-center hidden">Usu√°rio ou senha incorretos</p>
      </form>
    </div>
  </div>

  <!-- MODAL ADICIONAR/EDITAR MARMITA -->
  <div id="modal-marmita" class="hidden fixed inset-0 z-[60] flex items-center justify-center p-4 modal-bg">
    <div class="bg-white rounded-3xl p-8 w-full max-w-lg shadow-2xl max-h-[90vh] overflow-y-auto">
      <h2 class="font-display text-2xl text-forest mb-6" id="modal-marmita-title">Nova Marmita</h2>
      <form onsubmit="salvarMarmita(event)" class="space-y-4">
        <input type="hidden" id="edit-marmita-id">
        <div>
          <label class="block text-xs font-bold uppercase text-gray-400 mb-1">Nome da Marmita *</label>
          <input id="marmita-nome" type="text" required class="w-full px-4 py-2 border rounded-lg focus:outline-forest">
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-xs font-bold uppercase text-gray-400 mb-1">Pre√ßo (R$) *</label>
            <input id="marmita-preco" type="number" step="0.01" required class="w-full px-4 py-2 border rounded-lg focus:outline-forest">
          </div>
          <div>
            <label class="block text-xs font-bold uppercase text-gray-400 mb-1">Calorias (kcal) *</label>
            <input id="marmita-kcal" type="number" required class="w-full px-4 py-2 border rounded-lg focus:outline-forest">
          </div>
        </div>
        <div>
          <label class="block text-xs font-bold uppercase text-gray-400 mb-1">Descri√ß√£o *</label>
          <textarea id="marmita-desc" required class="w-full px-4 py-2 border rounded-lg focus:outline-forest h-20"></textarea>
        </div>
        <div>
          <label class="block text-xs font-bold uppercase text-gray-400 mb-1">Categoria *</label>
          <select id="marmita-cat" required class="w-full px-4 py-2 border rounded-lg focus:outline-forest">
            <option value="marmita">Marmita</option>
            <option value="sopa">Sopa</option>
            <option value="suco">Suco</option>
            <option value="sobremesa">Sobremesa</option>
            <option value="proteico">Proteico</option>
            <option value="low-carb">Low Carb</option>
            <option value="vegano">Vegano</option>
          </select>
        </div>
        <div class="bg-sage/10 p-4 rounded-lg">
          <label class="flex items-center gap-3 cursor-pointer">
            <input type="checkbox" id="marmita-visivel" checked class="w-5 h-5 rounded border-sage/50">
            <div>
              <p class="font-bold text-sm text-forest">üëÅÔ∏è Vis√≠vel para Clientes</p>
              <p class="text-xs text-gray-500">Desmarque para ocultar este item do card√°pio</p>
            </div>
          </label>
        </div>
        <div class="flex gap-3 pt-4">
          <button type="submit" class="flex-1 bg-forest text-white py-3 rounded-xl font-bold hover:bg-forest/90 transition-all">Salvar</button>
          <button type="button" onclick="closeModalMarmita()" class="flex-1 border border-gray-300 py-3 rounded-xl font-bold hover:bg-gray-50 transition-all">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- MODAL ADICIONAR/EDITAR COMBO -->
  <div id="modal-combo" class="hidden fixed inset-0 z-[60] flex items-center justify-center p-4 modal-bg">
    <div class="bg-white rounded-3xl p-8 w-full max-w-2xl shadow-2xl max-h-[90vh] overflow-y-auto">
      <h2 class="font-display text-2xl text-forest mb-6" id="modal-combo-title">Novo Combo</h2>
      <form onsubmit="salvarCombo(event)" class="space-y-4">
        <input type="hidden" id="edit-combo-id">
        <div>
          <label class="block text-xs font-bold uppercase text-gray-400 mb-1">Nome do Combo *</label>
          <input id="combo-nome" type="text" required placeholder="Ex: Kit 10 Marmitas" class="w-full px-4 py-2 border rounded-lg focus:outline-forest">
        </div>

        <!-- TIPO DE COMBO -->
        <div class="bg-cream p-4 rounded-xl border-2 border-sage/20">
          <label class="block text-xs font-bold uppercase text-gray-400 mb-3">Tipo de Combo *</label>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
            <label class="flex items-start gap-3 p-4 border-2 border-sage/30 rounded-xl cursor-pointer hover:border-forest transition-all bg-white">
              <input type="radio" name="tipo-combo" value="aberto" checked onchange="toggleTipoCombo()" class="mt-1">
              <div>
                <p class="font-bold text-forest">üõí Combo Aberto</p>
                <p class="text-xs text-gray-500">Cliente escolhe os itens</p>
              </div>
            </label>
            <label class="flex items-start gap-3 p-4 border-2 border-sage/30 rounded-xl cursor-pointer hover:border-forest transition-all bg-white">
              <input type="radio" name="tipo-combo" value="fechado" onchange="toggleTipoCombo()" class="mt-1">
              <div>
                <p class="font-bold text-forest">üì¶ Combo Fechado</p>
                <p class="text-xs text-gray-500">Itens pr√©-definidos</p>
              </div>
            </label>
          </div>
        </div>

        <!-- CONFIGURA√á√ÉO COMBO ABERTO -->
        <div id="config-aberto" class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-xs font-bold uppercase text-gray-400 mb-1">Quantidade de Itens *</label>
            <input id="combo-qtd" type="number" min="1" required class="w-full px-4 py-2 border rounded-lg focus:outline-forest">
          </div>
          <div>
            <label class="block text-xs font-bold uppercase text-gray-400 mb-1">Pre√ßo Total (R$) *</label>
            <input id="combo-preco" type="number" step="0.01" required class="w-full px-4 py-2 border rounded-lg focus:outline-forest">
          </div>
        </div>

        <!-- CONFIGURA√á√ÉO COMBO FECHADO -->
        <div id="config-fechado" class="hidden">
          <label class="block text-xs font-bold uppercase text-gray-400 mb-3">Itens do Combo Fechado *</label>
          <div class="bg-white border-2 border-sage/20 rounded-xl p-4 max-h-96 overflow-y-auto" id="itens-combo-container">
            <!-- Ser√° preenchido dinamicamente -->
          </div>
          <div class="mt-4">
            <label class="block text-xs font-bold uppercase text-gray-400 mb-1">Pre√ßo do Combo Fechado (R$) *</label>
            <input id="combo-preco-fechado" type="number" step="0.01" class="w-full px-4 py-2 border rounded-lg focus:outline-forest">
          </div>
        </div>

        <div class="bg-sage/10 p-4 rounded-lg">
          <p class="text-xs text-gray-600">üí° <span id="preco-unitario-preview">Configure o combo acima</span></p>
        </div>

        <div class="bg-sage/10 p-4 rounded-lg">
          <label class="flex items-center gap-3 cursor-pointer">
            <input type="checkbox" id="combo-visivel" checked class="w-5 h-5 rounded border-sage/50">
            <div>
              <p class="font-bold text-sm text-forest">üëÅÔ∏è Vis√≠vel para Clientes</p>
              <p class="text-xs text-gray-500">Desmarque para ocultar este combo</p>
            </div>
          </label>
        </div>

        <div class="flex gap-3 pt-4">
          <button type="submit" class="flex-1 bg-forest text-white py-3 rounded-xl font-bold hover:bg-forest/90 transition-all">Salvar Combo</button>
          <button type="button" onclick="closeModalCombo()" class="flex-1 border border-gray-300 py-3 rounded-xl font-bold hover:bg-gray-50 transition-all">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- APP PRINCIPAL -->
  <div id="main-app" class="min-h-screen flex flex-col">
    <header class="bg-forest text-cream px-6 py-4 flex justify-between items-center sticky top-0 z-40 shadow-md">
      <div>
        <h1 class="font-display text-xl md:text-2xl">Sabor e Sa√∫de</h1>
        <p id="header-user-info" class="text-[10px] text-sage uppercase tracking-widest">Modo Cliente</p>
      </div>
      <div class="flex items-center gap-3">
        <button id="btn-admin-view" onclick="openAdminModal()" class="text-xs border border-sage/30 px-3 py-2 rounded-lg hover:bg-white/10 transition-all">Acesso Admin</button>
        <button onclick="resetarPedido()" class="text-xs bg-terracotta/30 px-3 py-2 rounded-lg hover:bg-terracotta/50 transition-all">Resetar</button>
      </div>
    </header>

    <div class="flex flex-1 overflow-hidden">
      <!-- SIDEBAR MODERADOR -->
      <aside id="sidebar" class="w-64 bg-white border-r hidden overflow-y-auto">
        <div class="p-4 bg-gray-50 border-b">
          <p class="text-xs font-bold text-gray-400 uppercase tracking-tighter">Gerenciamento</p>
        </div>
        <nav class="p-4 space-y-2">
          <button onclick="showPage('dashboard')" class="w-full text-left px-4 py-3 rounded-lg hover:bg-sage/10 transition-all">üìä Dashboard</button>
          <button onclick="showPage('combos')" class="w-full text-left px-4 py-3 rounded-lg hover:bg-sage/10 transition-all">üì¶ Gerenciar Combos</button>
          <button onclick="showPage('marmitas')" class="w-full text-left px-4 py-3 rounded-lg hover:bg-sage/10 transition-all">üç± Gerenciar Card√°pio</button>
          <hr class="my-4">
          <button onclick="entrarComoCliente()" class="w-full text-left px-4 py-3 rounded-lg text-terracotta hover:bg-terracotta/5 transition-all">‚¨ÖÔ∏è Ver como Cliente</button>
        </nav>
      </aside>

      <!-- CONTE√öDO -->
      <main class="flex-1 overflow-y-auto p-4 md:p-8 pb-32">

        <!-- CLIENTE: CARD√ÅPIO -->
        <section id="page-cardapio" class="fade-in max-w-4xl mx-auto">
          <div class="mb-8">
            <h2 class="font-display text-3xl text-forest">Monte seu Kit üç±</h2>
            <p class="text-sage">Escolha um combo abaixo para come√ßar sua sele√ß√£o.</p>
          </div>

          <div id="combos-container" class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-10"></div>

          <div id="marmitas-section" class="hidden fade-in border-t border-sage/20 pt-8">
            <div class="bg-forest text-white p-6 rounded-2xl mb-8 shadow-xl flex justify-between items-center">
              <div>
                <p class="text-xs opacity-70 uppercase font-bold">Progresso do Kit</p>
                <p class="text-lg font-bold" id="combo-name-display">Carregando...</p>
                <p class="text-xs opacity-70 mt-1" id="combo-tipo-badge"></p>
              </div>
              <div class="text-right" id="progress-counter">
                <span class="text-3xl font-display font-bold" id="current-marmitas">0</span>
                <span class="text-xl opacity-50">/</span>
                <span class="text-xl opacity-50" id="max-marmitas">10</span>
              </div>
            </div>

            <!-- LISTA DE ITENS DO COMBO FECHADO -->
            <div id="combo-fechado-itens" class="hidden mb-8 bg-white rounded-2xl p-6 shadow-sm border border-sage/20">
              <h3 class="text-xl font-bold text-forest mb-4">üì¶ Itens inclusos neste combo:</h3>
              <div id="lista-itens-fechado" class="space-y-2"></div>
            </div>

            <!-- SELE√á√ÉO DE MARMITAS (APENAS COMBO ABERTO) -->
            <div id="selecao-marmitas-container">
              <h3 class="text-xl font-bold text-forest mb-4">Selecione suas refei√ß√µes:</h3>
              <div id="marmitas-container" class="grid grid-cols-1 gap-3 mb-8"></div>
            </div>

            <!-- PREFER√äNCIAS E OBSERVA√á√ïES -->
            <div class="bg-white rounded-3xl p-6 shadow-sm border border-sage/20 mb-8">
              <h3 class="font-display text-2xl text-forest mb-6">Prefer√™ncias do Pedido</h3>

              <div class="mb-6">
                <label class="block text-xs font-bold uppercase text-gray-400 mb-2 ml-1">Prefer√™ncia de Tempero</label>
                <div class="flex gap-2">
                  <button type="button" onclick="setSpiceLevel(1)" class="spice-btn flex-1 py-3 border border-sage/20 rounded-xl bg-white hover:border-forest transition-all">üåø Suave</button>
                  <button type="button" onclick="setSpiceLevel(2)" class="spice-btn flex-1 py-3 border-2 border-forest bg-forest/5 rounded-xl font-bold">üå∂Ô∏è M√©dio</button>
                  <button type="button" onclick="setSpiceLevel(3)" class="spice-btn flex-1 py-3 border border-sage/20 rounded-xl bg-white hover:border-forest transition-all">üî• Picante</button>
                </div>
              </div>

              <div class="mb-6">
                <label class="block text-xs font-bold uppercase text-gray-400 mb-1 ml-1">Observa√ß√µes Adicionais</label>
                <textarea id="observations" placeholder="Ex: Sem cebola, restri√ß√µes alimentares, prefer√™ncias especiais..." class="w-full px-4 py-3 bg-cream/50 border border-sage/20 rounded-xl focus:outline-forest h-24"></textarea>
              </div>
            </div>

            <!-- DADOS PARA ENTREGA -->
            <div class="bg-white rounded-3xl p-6 shadow-sm border border-sage/20 mb-8">
              <h3 class="font-display text-2xl text-forest mb-6">Dados para Entrega</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="mb-4">
                  <label class="block text-xs font-bold uppercase text-gray-400 mb-1 ml-1">Seu Nome *</label>
                  <input id="cliente-nome" type="text" placeholder="Ex: Jo√£o Silva" class="w-full px-4 py-3 bg-cream/50 border border-sage/20 rounded-xl focus:outline-forest">
                </div>
                <div class="mb-4">
                  <label class="block text-xs font-bold uppercase text-gray-400 mb-1 ml-1">WhatsApp de Contato *</label>
                  <input id="cliente-tel" type="tel" placeholder="(00) 00000-0000" class="w-full px-4 py-3 bg-cream/50 border border-sage/20 rounded-xl focus:outline-forest">
                </div>
              </div>
              <div class="mb-4">
                <label class="block text-xs font-bold uppercase text-gray-400 mb-1 ml-1">Endere√ßo de Entrega *</label>
                <textarea id="cliente-endereco" placeholder="Rua, n√∫mero, bairro e ponto de refer√™ncia" class="w-full px-4 py-3 bg-cream/50 border border-sage/20 rounded-xl focus:outline-forest h-24"></textarea>
              </div>
            </div>

            <!-- BARRA DE FINALIZA√á√ÉO FIXA -->
            <div class="fixed bottom-0 left-0 right-0 bg-white border-t p-4 md:p-6 flex flex-col md:flex-row justify-between items-center shadow-[0_-10px_40px_rgba(0,0,0,0.1)] z-50">
              <div class="text-center md:text-left mb-4 md:mb-0">
                <p class="text-xs text-gray-400 uppercase font-bold">Total do Kit</p>
                <p id="total-price" class="text-3xl font-display text-terracotta">R$ 0,00</p>
              </div>
              <button onclick="finalizarPedido()" class="w-full md:w-auto bg-forest text-white px-12 py-4 rounded-2xl font-bold shadow-lg hover:scale-105 transition-all flex items-center justify-center gap-2">
                üì± Enviar para WhatsApp
              </button>
            </div>
          </div>
        </section>

        <!-- DASHBOARD ADMIN -->
        <section id="page-dashboard" class="hidden"> 
          <h2 class="text-2xl font-bold mb-6 font-display text-forest">Painel Administrativo</h2>
          <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-sage/20">
              <p class="text-gray-400 text-sm mb-1">Total de Combos</p>
              <p class="text-3xl font-bold text-forest" id="stat-combos">0</p>
              <p class="text-xs text-sage mt-1" id="stat-combos-visiveis"></p>
            </div>
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-sage/20">
              <p class="text-gray-400 text-sm mb-1">Itens no Card√°pio</p>
              <p class="text-3xl font-bold text-forest" id="stat-marmitas">0</p>
              <p class="text-xs text-sage mt-1" id="stat-marmitas-visiveis"></p>
            </div>
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-sage/20">
              <p class="text-gray-400 text-sm mb-1">Pre√ßo M√©dio</p>
              <p class="text-3xl font-bold text-terracotta" id="stat-preco-medio">R$ 0</p>
            </div>
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-sage/20">
              <p class="text-gray-400 text-sm mb-1">Combos Fechados</p>
              <p class="text-3xl font-bold text-forest" id="stat-combos-fechados">0</p>
            </div>
          </div>
          <div class="bg-white p-6 rounded-2xl shadow-sm border border-sage/20">
            <h3 class="font-bold text-lg mb-4">A√ß√µes R√°pidas</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
              <button onclick="showPage('combos')" class="border-2 border-forest text-forest px-6 py-3 rounded-xl font-bold hover:bg-forest hover:text-white transition-all">Gerenciar Combos</button>
              <button onclick="showPage('marmitas')" class="border-2 border-forest text-forest px-6 py-3 rounded-xl font-bold hover:bg-forest hover:text-white transition-all">Gerenciar Card√°pio</button>
            </div>
          </div>
        </section>

        <!-- GERENCIAR COMBOS -->
        <section id="page-combos" class="hidden"> 
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold font-display text-forest">Gerenciar Combos</h2>
            <button onclick="abrirModalCombo()" class="bg-forest text-white px-6 py-3 rounded-xl font-bold hover:scale-105 transition-all">+ Novo Combo</button>
          </div>
          <div id="combos-admin-list" class="space-y-3"></div>
        </section>

        <!-- GERENCIAR MARMITAS -->
        <section id="page-marmitas" class="hidden"> 
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold font-display text-forest">Gerenciar Card√°pio</h2>
            <button onclick="abrirModalMarmita()" class="bg-forest text-white px-6 py-3 rounded-xl font-bold hover:scale-105 transition-all">+ Novo Item</button>
          </div>
          <div id="marmitas-admin-list" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
        </section>

      </main>
    </div>
  </div>

  <!-- NOTIFICA√á√ÉO TOAST -->
  <div id="toast" class="hidden fixed bottom-24 left-1/2 -translate-x-1/2 bg-charcoal text-white px-8 py-4 rounded-2xl shadow-2xl z-[70] font-bold"></div>

  <script>
    // ============================================
    // CONFIGURA√á√ÉO DO FIREBASE
    // ============================================
    // ‚ö†Ô∏è IMPORTANTE: VOC√ä PRECISA SUBSTITUIR ESTAS CONFIGURA√á√ïES
    // PELAS SUAS PR√ìPRIAS AP√ìS CRIAR O PROJETO NO FIREBASE

const firebaseConfig = {
  apiKey: "AIzaSyBL0z6PwA6Ik_U671G7HJZLsHT9udCT7YI",
  authDomain: "sabor-e-saude-a233e.firebaseapp.com",
  databaseURL: "https://sabor-e-saude-a233e-default-rtdb.firebaseio.com",
  projectId: "sabor-e-saude-a233e",
  storageBucket: "sabor-e-saude-a233e.firebasestorage.app",
  messagingSenderId: "283293618461",
  appId: "1:283293618461:web:1db0ad8b6db9f145d791f4",
  measurementId: "G-R6LW9FKEQF"
};

    // Inicializar Firebase
    let database;
    let firebaseInitialized = false;

    try {
      firebase.initializeApp(firebaseConfig);
      database = firebase.database();
      firebaseInitialized = true;
      console.log("‚úÖ Firebase inicializado com sucesso!");
    } catch (error) {
      console.warn("‚ö†Ô∏è Firebase n√£o configurado. Usando modo local tempor√°rio.");
      console.warn("Para sincronizar entre dispositivos, siga as instru√ß√µes no arquivo FIREBASE_SETUP.txt");
      firebaseInitialized = false;
    }

    // --- CONFIGURA√á√ÉO ---
    const WHATSAPP_RESTAURANTE = "5547996988109"; 
    const STORAGE_MARMITAS = 'marmitas_fit_data';
    const STORAGE_COMBOS = 'combos_fit_data';

    let isAdmin = false;
    let currentCombo = null;
    let quantities = {};
    let spiceLevel = 2;
    let maxMarmitas = 0;
    let marmitasCache = [];
    let combosCache = [];

    // ============================================
    // FUN√á√ïES DO FIREBASE
    // ============================================

    async function carregarMarmitasFirebase() {
      if (!firebaseInitialized) {
        // Fallback para localStorage
        const local = localStorage.getItem(STORAGE_MARMITAS);
        return local ? JSON.parse(local) : [];
      }

      try {
        const snapshot = await database.ref('marmitas').once('value');
        const data = snapshot.val();
        if (data) {
          marmitasCache = Object.values(data);
          return marmitasCache;
        }
        return [];
      } catch (error) {
        console.error("Erro ao carregar marmitas:", error);
        return [];
      }
    }

    async function carregarCombosFirebase() {
      if (!firebaseInitialized) {
        const local = localStorage.getItem(STORAGE_COMBOS);
        return local ? JSON.parse(local) : [];
      }

      try {
        const snapshot = await database.ref('combos').once('value');
        const data = snapshot.val();
        if (data) {
          combosCache = Object.values(data);
          return combosCache;
        }
        return [];
      } catch (error) {
        console.error("Erro ao carregar combos:", error);
        return [];
      }
    }

    async function salvarMarmitaFirebase(marmita) {
      if (!firebaseInitialized) {
        let marmitas = JSON.parse(localStorage.getItem(STORAGE_MARMITAS) || '[]');
        const index = marmitas.findIndex(m => m.id === marmita.id);
        if (index !== -1) {
          marmitas[index] = marmita;
        } else {
          marmitas.push(marmita);
        }
        localStorage.setItem(STORAGE_MARMITAS, JSON.stringify(marmitas));
        return;
      }

      try {
        await database.ref(`marmitas/${marmita.id}`).set(marmita);
        marmitasCache = await carregarMarmitasFirebase();
      } catch (error) {
        console.error("Erro ao salvar marmita:", error);
        throw error;
      }
    }

    async function salvarComboFirebase(combo) {
      if (!firebaseInitialized) {
        let combos = JSON.parse(localStorage.getItem(STORAGE_COMBOS) || '[]');
        const index = combos.findIndex(c => c.id === combo.id);
        if (index !== -1) {
          combos[index] = combo;
        } else {
          combos.push(combo);
        }
        localStorage.setItem(STORAGE_COMBOS, JSON.stringify(combos));
        return;
      }

      try {
        await database.ref(`combos/${combo.id}`).set(combo);
        combosCache = await carregarCombosFirebase();
      } catch (error) {
        console.error("Erro ao salvar combo:", error);
        throw error;
      }
    }

    async function excluirMarmitaFirebase(id) {
      if (!firebaseInitialized) {
        let marmitas = JSON.parse(localStorage.getItem(STORAGE_MARMITAS) || '[]');
        marmitas = marmitas.filter(m => m.id !== id);
        localStorage.setItem(STORAGE_MARMITAS, JSON.stringify(marmitas));
        return;
      }

      try {
        await database.ref(`marmitas/${id}`).remove();
        marmitasCache = await carregarMarmitasFirebase();
      } catch (error) {
        console.error("Erro ao excluir marmita:", error);
        throw error;
      }
    }

    async function excluirComboFirebase(id) {
      if (!firebaseInitialized) {
        let combos = JSON.parse(localStorage.getItem(STORAGE_COMBOS) || '[]');
        combos = combos.filter(c => c.id !== id);
        localStorage.setItem(STORAGE_COMBOS, JSON.stringify(combos));
        return;
      }

      try {
        await database.ref(`combos/${id}`).remove();
        combosCache = await carregarCombosFirebase();
      } catch (error) {
        console.error("Erro ao excluir combo:", error);
        throw error;
      }
    }

    // ============================================
    // INICIALIZA√á√ÉO
    // ============================================

    async function initData() {
      try {
        // Mostrar loading
        document.getElementById('loading').classList.remove('hidden');

        // Carregar dados
        marmitasCache = await carregarMarmitasFirebase();
        combosCache = await carregarCombosFirebase();

        // Se n√£o houver dados, criar dados iniciais
        if (marmitasCache.length === 0) {
          const iniciais = [
            { id: 1, nome: 'Frango com Batata Doce', preco: 22.00, kcal: 350, desc: 'Frango grelhado e pur√™ de batata doce', cat: 'marmita', visivel: true },
            { id: 2, nome: 'Patinho com Arroz Integral', preco: 25.00, kcal: 400, desc: 'Carne mo√≠da magra e legumes', cat: 'marmita', visivel: true },
            { id: 3, nome: 'Til√°pia com Ervas', preco: 28.00, kcal: 300, desc: 'Peixe assado e vagem', cat: 'marmita', visivel: true },
            { id: 4, nome: 'Strogonoff de Frango Fit', preco: 24.00, kcal: 380, desc: 'Com arroz integral e batata palha assada', cat: 'marmita', visivel: true },
            { id: 5, nome: 'Sopa de Legumes', preco: 15.00, kcal: 180, desc: 'Sopa cremosa com legumes frescos', cat: 'sopa', visivel: true },
            { id: 6, nome: 'Suco Detox Verde', preco: 8.00, kcal: 80, desc: 'Couve, lim√£o e gengibre', cat: 'suco', visivel: true }
          ];

          for (const m of iniciais) {
            await salvarMarmitaFirebase(m);
          }
          marmitasCache = await carregarMarmitasFirebase();
        }

        if (combosCache.length === 0) {
          const combosIniciais = [
            { id: 1, nome: 'Kit 10 Marmitas', qtd: 10, preco_base: 210.00, tipo: 'aberto', visivel: true, itens: {} },
            { id: 2, nome: 'Kit 20 Marmitas', qtd: 20, preco_base: 400.00, tipo: 'aberto', visivel: true, itens: {} }
          ];

          for (const c of combosIniciais) {
            await salvarComboFirebase(c);
          }
          combosCache = await carregarCombosFirebase();
        }

        // Configurar listeners em tempo real
        if (firebaseInitialized) {
          database.ref('marmitas').on('value', async (snapshot) => {
            const data = snapshot.val();
            if (data) {
              marmitasCache = Object.values(data);
              renderCardapio();
              if (isAdmin) {
                renderMarmitasAdmin();
                atualizarDashboard();
              }
            }
          });

          database.ref('combos').on('value', async (snapshot) => {
            const data = snapshot.val();
            if (data) {
              combosCache = Object.values(data);
              renderCardapio();
              if (isAdmin) {
                renderCombosAdmin();
                atualizarDashboard();
              }
            }
          });
        }

        // Renderizar
        renderCardapio();

        // Esconder loading
        document.getElementById('loading').classList.add('hidden');

        if (!firebaseInitialized) {
          showToast("‚ö†Ô∏è Modo offline - Configure o Firebase para sincronizar");
        }

      } catch (error) {
        console.error("Erro ao inicializar:", error);
        document.getElementById('loading').classList.add('hidden');
        showToast("‚ùå Erro ao carregar dados");
      }
    }

    // ============================================
    // RESTANTE DO C√ìDIGO (continua igual...)
    // ============================================

    // [O restante das fun√ß√µes continua exatamente como estava]
    // Para economizar espa√ßo, vou incluir apenas as principais fun√ß√µes modificadas

    async function salvarMarmita(e) {
      e.preventDefault();

      const id = document.getElementById('edit-marmita-id').value;
      const nome = document.getElementById('marmita-nome').value.trim();
      const preco = parseFloat(document.getElementById('marmita-preco').value);
      const kcal = parseInt(document.getElementById('marmita-kcal').value);
      const desc = document.getElementById('marmita-desc').value.trim();
      const cat = document.getElementById('marmita-cat').value;
      const visivel = document.getElementById('marmita-visivel').checked;

      const marmita = {
        id: id ? parseInt(id) : (marmitasCache.length > 0 ? Math.max(...marmitasCache.map(m => m.id)) + 1 : 1),
        nome,
        preco,
        kcal,
        desc,
        cat,
        visivel
      };

      try {
        await salvarMarmitaFirebase(marmita);
        showToast(id ? "‚úÖ Item atualizado!" : "‚úÖ Item criado!");
        closeModalMarmita();
        renderMarmitasAdmin();
        renderCardapio();
      } catch (error) {
        showToast("‚ùå Erro ao salvar item");
      }
    }

    async function salvarCombo(e) {
      e.preventDefault();

      const id = document.getElementById('edit-combo-id').value;
      const nome = document.getElementById('combo-nome').value.trim();
      const visivel = document.getElementById('combo-visivel').checked;
      const tipo = document.querySelector('input[name="tipo-combo"]:checked').value;

      let qtd, preco_base, itens = {};

      if(tipo === 'fechado') {
        const inputs = document.querySelectorAll('input[name^="item-combo-"]');
        let totalItens = 0;

        inputs.forEach(input => {
          const itemId = input.name.replace('item-combo-', '');
          const quantidade = parseInt(input.value) || 0;
          if(quantidade > 0) {
            itens[itemId] = quantidade;
            totalItens += quantidade;
          }
        });

        if(totalItens === 0) {
          showToast("‚ö†Ô∏è Selecione pelo menos um item com quantidade maior que 0");
          return;
        }

        qtd = totalItens;
        preco_base = parseFloat(document.getElementById('combo-preco-fechado').value);
      } else {
        qtd = parseInt(document.getElementById('combo-qtd').value);
        preco_base = parseFloat(document.getElementById('combo-preco').value);
      }

      const combo = {
        id: id ? parseInt(id) : (combosCache.length > 0 ? Math.max(...combosCache.map(c => c.id)) + 1 : 1),
        nome,
        qtd,
        preco_base,
        visivel,
        tipo,
        itens
      };

      try {
        await salvarComboFirebase(combo);
        showToast(id ? "‚úÖ Combo atualizado!" : "‚úÖ Combo criado!");
        closeModalCombo();
        renderCombosAdmin();
        renderCardapio();
      } catch (error) {
        showToast("‚ùå Erro ao salvar combo");
      }
    }

    // Incluir TODAS as outras fun√ß√µes do c√≥digo anterior aqui...
    // (Por quest√£o de espa√ßo, n√£o vou duplicar todo o c√≥digo)

    window.onload = initData;
  </script>
</body>
</html>